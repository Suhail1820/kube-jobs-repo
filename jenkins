pipeline {
    agent any

    environment {
        // Directly set the KUBECONFIG environment variable to the path where the kubeconfig file will be placed
        KUBECONFIG = '/home/admin/.kube/config'
    }

    stages {
        stage('Checkout SCM') {
            steps {
                checkout scm
            }
        }

        stage('Deploy Job to Kubernetes') {
            steps {
                withCredentials([file(credentialsId: 'kube-conf', variable: 'KUBECONFIG_FILE')]) {
                    script {
                        // Use kubectl with the provided kubeconfig file directly
                        sh '''
                            cp $KUBECONFIG_FILE $KUBECONFIG
                            kubectl config use-context jenkins-context
                            kubectl apply -f /home/admin/job.yaml
                        '''
                    }
                }
            }
        }
    }
}
