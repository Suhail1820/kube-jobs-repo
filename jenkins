pipeline {
    agent any
    triggers {
        pollSCM('* * * * *') // Poll the repository every minute for changes
    }
    stages {
        stage('Checkout Code') {
            steps {
                checkout scm: [
                    $class: 'GitSCM',
                    branches: [[name: 'refs/heads/main']],  // Specify the branch here
                    userRemoteConfigs: [[url: 'https://github.com/your-repository-url']]
                ]
            }
        }
        stage('Deploy to Kubernetes') {
            steps {
                script {
                    withCredentials([string(credentialsId: 'jenkins-sec', variable: 'KUBE_TOKEN')]) {
                        sh """
                            kubectl config set-credentials jenkins --token=${KUBE_TOKEN}
                            kubectl config set-context --current --user=jenkins
                            kubectl apply -f kube-jobs-repo/manifests/job.yaml
                        """
                    }
                }
            }
        }
    }
}
